<div dir="rtl" align="right">

<h2>بخش دوم: شکار تهدیدات - تحلیل جامع تکنیک‌های حرکت جانبی</h2>

<p>حرکت جانبی (Lateral Movement) به مجموعه‌ای از تکنیک‌ها اطلاق می‌شود که مهاجمان پس از به دست آوردن دسترسی اولیه به یک سیستم در شبکه، برای نفوذ به سایر سیستم‌ها و گسترش دامنه کنترل خود استفاده می‌کنند. این مرحله از زنجیره حمله (Kill Chain) بسیار حیاتی است، زیرا مهاجمان معمولاً هدف نهایی خود را در سیستم اولیه نفوذ پیدا نمی‌کنند و باید به سیستم‌های دیگر حرکت کنند. شناسایی به موقع این تکنیک‌ها می‌تواند به مهار سریع حملات و جلوگیری از دسترسی مهاجمان به دارایی‌های حساس کمک کند. در این بخش، به بررسی تفصیلی تکنیک‌های رایج حرکت جانبی که در پوستر SANS FOR508 به آن‌ها اشاره شده، به همراه جزئیات فنی تکمیلی که از تحقیقات گسترده به دست آمده، می‌پردازیم.</p>

<h3>Remote Desktop Protocol (RDP)</h3>

<p>پروتکل دسکتاپ از راه دور (RDP) یکی از شایع‌ترین روش‌های مشروع برای دسترسی از راه دور به سیستم‌های ویندوزی است که توسط مدیران سیستم برای مدیریت سرورها و ایستگاه‌های کاری استفاده می‌شود. با این حال، مهاجمان نیز به طور گسترده‌ای از RDP برای حرکت جانبی استفاده می‌کنند، به ویژه زمانی که اعتبارنامه‌های معتبر را به دست آورده باشند. RDP بر روی پورت 3389 کار می‌کند و یک جلسه گرافیکی کامل را به کاربر فراهم می‌کند.</p>

<p>در سیستم مقصد (سیستمی که به آن متصل می‌شویم)، شواهد متعددی از اتصال RDP باقی می‌ماند. در لاگ‌های رویداد، Event ID 4624 با Logon Type 10 در لاگ Security نشان‌دهنده یک ورود RDP موفق است. این رویداد شامل اطلاعات مهمی مانند آدرس IP مبدا، نام کاربری و زمان ورود است. همچنین، Event ID 21 و 25 در لاگ <code>Microsoft-Windows-TerminalServices-LocalSessionManager/Operational</code> به ترتیب نشان‌دهنده موفقیت در ورود به جلسه و اتصال مجدد به جلسه هستند. Event ID 4778 و 4779 در لاگ Security نیز به ترتیب نشان‌دهنده اتصال مجدد (Reconnection) و قطع اتصال (Disconnection) جلسه RDP هستند.</p>

<p>در رجیستری سیستم مقصد، کلید <code>NTUSER.DAT\Software\Microsoft\Terminal Server Client\Servers</code> حاوی لیست سرورهایی است که به آن‌ها از طریق RDP متصل شده‌اند. این کلید برای هر کاربر وجود دارد و می‌تواند نشان دهد که کدام سیستم‌ها به عنوان مقصد RDP استفاده شده‌اند. همچنین، کلیدهای UserAssist و BAM/DAM می‌توانند شواهدی از اجرای <code>mstsc.exe</code> (کلاینت RDP) را ثبت کنند.</p>

<p>در سیستم فایل سیستم مقصد، فایل‌های Prefetch برای <code>rdpclip.exe</code> و <code>tstheme.exe</code> ایجاد می‌شوند. <code>rdpclip.exe</code> مسئول مدیریت کلیپ‌بورد بین سیستم محلی و راه دور است و <code>tstheme.exe</code> مسئول مدیریت تم‌های بصری در جلسه RDP است. وجود این فایل‌های Prefetch نشان‌دهنده قوی این است که سیستم یک اتصال RDP ورودی را دریافت کرده است.</p>

<p>در سیستم مبدا (سیستمی که از آن اتصال RDP برقرار می‌شود)، Event ID 1149 در لاگ <code>Microsoft-Windows-TerminalServices-RemoteConnectionManager/Operational</code> نشان‌دهنده یک تلاش موفق برای اتصال RDP است. در رجیستری، کلیدهای UserAssist و BAM/DAM شواهدی از اجرای <code>mstsc.exe</code> را ثبت می‌کنند. در سیستم فایل، فایل Prefetch برای <code>mstsc.exe</code> ایجاد می‌شود و فایل‌های Jumplist در <code>AppData\Roaming\Microsoft\Windows\Recent\AutomaticDestinations</code> می‌توانند اتصالات اخیر RDP را نشان دهند.</p>

<p>یکی از نکات مهم که در پوستر اصلی به آن اشاره نشده بود، وجود فایل‌های Bitmap Cache است. زمانی که یک کاربر از طریق RDP به یک سیستم متصل می‌شود، تصاویر صفحه نمایش به صورت bitmap در سیستم مبدا کش می‌شوند تا عملکرد را بهبود بخشند. این فایل‌ها در <code>AppData\Local\Microsoft\Terminal Server Client\Cache</code> ذخیره می‌شوند و می‌توانند اطلاعات بصری ارزشمندی در مورد فعالیت‌هایی که در طول جلسه RDP انجام شده است، فراهم کنند. ابزارهایی مانند BMC-Tools می‌توانند این فایل‌ها را تجزیه و تحلیل کرده و تصاویر را بازسازی کنند.</p>

<h3>PsExec</h3>

<p>PsExec یک ابزار رایگان از مجموعه Sysinternals مایکروسافت است که به مدیران سیستم اجازه می‌دهد فرآیندها را بر روی سیستم‌های راه دور اجرا کنند. این ابزار بسیار محبوب است زیرا رایگان، کارآمد و به راحتی قابل استفاده است. با این حال، همین ویژگی‌ها باعث شده که مهاجمان نیز به طور گسترده‌ای از آن برای حرکت جانبی استفاده کنند. PsExec بر روی پروتکل SMB (پورت 445) کار می‌کند و با ایجاد یک سرویس موقت بر روی سیستم راه دور، فرآیند مورد نظر را اجرا می‌کند.</p>

<p>زمانی که PsExec برای اجرای یک فرآیند بر روی سیستم راه دور استفاده می‌شود، یک سرویس با نام پیش‌فرض "PSEXESVC" بر روی سیستم مقصد ایجاد می‌شود. این سرویس یک فایل اجرایی با همان نام (<code>PSEXESVC.exe</code>) را در شیر <code>ADMIN$</code> (که معمولاً به <code>C:\Windows</code> اشاره دارد) کپی می‌کند. پس از اجرای فرآیند مورد نظر، سرویس و فایل اجرایی به طور خودکار حذف می‌شوند. با این حال، شواهد متعددی از این فعالیت باقی می‌ماند.</p>

<p>در لاگ‌های رویداد سیستم مقصد، Event ID 7045 در لاگ System نشان‌دهنده ایجاد یک سرویس جدید است. این رویداد شامل نام سرویس (PSEXESVC)، مسیر فایل اجرایی (<code>C:\Windows\PSEXESVC.exe</code>) و حساب کاربری که سرویس تحت آن نصب شده است (معمولاً LocalSystem) می‌باشد. Event ID 4624 با Logon Type 3 در لاگ Security نشان‌دهنده یک ورود شبکه‌ای است که معمولاً قبل از ایجاد سرویس رخ می‌دهد. Event ID 4688 در لاگ Security (اگر Process Creation Auditing فعال باشد) نشان‌دهنده ایجاد فرآیند <code>PSEXESVC.exe</code> است.</p>

<p>اگر Sysmon در سیستم نصب شده باشد، Event ID 1 (Process Creation) نشان‌دهنده ایجاد فرآیند <code>PSEXESVC.exe</code> است و Event ID 17 و 18 (Pipe Created و Pipe Connected) نشان‌دهنده ایجاد و اتصال به Named Pipe با نام <code>\pipe\PSEXESVC</code> هستند. Named Pipes یک مکانیزم ارتباطی بین فرآیندها (IPC) هستند که PsExec از آن‌ها برای ارتباط بین سیستم مبدا و مقصد استفاده می‌کند.</p>

<p>در رجیستری سیستم مقصد، یک کلید سرویس موقت در <code>HKLM\SYSTEM\CurrentControlSet\Services\PSEXESVC</code> ایجاد می‌شود. اگرچه این کلید پس از اتمام کار حذف می‌شود، اما ممکن است در Transaction Logs رجیستری یا در Volume Shadow Copies باقی بماند.</p>

<p>در سیستم فایل سیستم مقصد، فایل <code>PSEXESVC.exe</code> به طور موقت در <code>C:\Windows</code> ایجاد و سپس حذف می‌شود. با این حال، شواهدی از این فایل در USN Journal (که تمامی تغییرات سیستم فایل NTFS را ثبت می‌کند) باقی می‌ماند. USN Journal رکوردهایی از ایجاد، تغییر و حذف فایل <code>PSEXESVC.exe</code> را ثبت می‌کند که می‌تواند timestamp های دقیقی برای این فعالیت‌ها فراهم کند. همچنین، یک فایل Prefetch برای <code>PSEXESVC.exe</code> ایجاد می‌شود که حتی پس از حذف فایل اجرایی، باقی می‌ماند. این فایل Prefetch اطلاعات ارزشمندی مانند تعداد دفعات اجرا، آخرین زمان اجرا و فایل‌ها و DLL هایی که توسط <code>PSEXESVC.exe</code> بارگذاری شده‌اند را فراهم می‌کند.</p>

<p>یکی از نکات مهم که در پوستر اصلی به آن اشاره نشده بود، این است که PsExec دارای یک سوئیچ <code>-r</code> است که به کاربر اجازه می‌دهد نام سرویس سفارشی را مشخص کند. مهاجمان پیشرفته اغلب از این سوئیچ استفاده می‌کنند تا از نام پیش‌فرض "PSEXESVC" اجتناب کنند و تشخیص را دشوارتر کنند. بنابراین، تحلیلگران نباید تنها به دنبال نام "PSEXESVC" باشند، بلکه باید به الگوهای رفتاری مانند ایجاد سرویس‌های موقت، کپی فایل‌های اجرایی به <code>ADMIN$</code> و استفاده از Named Pipes نیز توجه کنند.</p>

<p>همچنین، نسخه‌های مختلفی از PsExec وجود دارند، از جمله Impacket PsExec (بخشی از مجموعه ابزار Impacket پایتون) و نسخه‌های موجود در فریمورک‌های C2 مانند Metasploit، CobaltStrike و Empire. اگرچه هسته اصلی یکسان است، اما تفاوت‌های جزئی در پیاده‌سازی آن‌ها وجود دارد. به عنوان مثال، Impacket PsExec ممکن است از نام‌های سرویس متفاوتی استفاده کند یا رفتار کمی متفاوتی در مدیریت Named Pipes داشته باشد. با این حال، اکثر تکنیک‌های تشخیص برای همه نسخه‌ها مشترک هستند.</p>

<h3>Scheduled Tasks</h3>

<p>وظایف زمان‌بندی شده (Scheduled Tasks) یک مکانیزم قدرتمند در ویندوز هستند که به کاربران و مدیران اجازه می‌دهند اجرای خودکار برنامه‌ها یا اسکریپت‌ها را در زمان‌های مشخص یا در پاسخ به رویدادهای خاص برنامه‌ریزی کنند. مهاجمان از این قابلیت برای حرکت جانبی و همچنین برای پایداری (Persistence) استفاده می‌کنند. با ایجاد یک وظیفه زمان‌بندی شده بر روی یک سیستم راه دور، مهاجم می‌تواند کد مخرب را در زمان دلخواه یا بلافاصله اجرا کند.</p>

<p>برای ایجاد یک وظیفه زمان‌بندی شده بر روی یک سیستم راه دور، مهاجمان معمولاً از دستور <code>schtasks.exe</code> با پارامتر <code>/S</code> (برای مشخص کردن سیستم راه دور) استفاده می‌کنند. همچنین، ابزارهایی مانند <code>at.exe</code> (که در نسخه‌های قدیمی‌تر ویندوز استفاده می‌شد) نیز می‌توانند برای این منظور به کار روند، اگرچه <code>at.exe</code> در نسخه‌های جدید ویندوز منسوخ شده است.</p>

<p>در لاگ‌های رویداد سیستم مقصد، Event ID 4698 در لاگ Security نشان‌دهنده ایجاد یک وظیفه زمان‌بندی شده جدید است. این رویداد شامل نام وظیفه، حساب کاربری که وظیفه را ایجاد کرده، و محتوای XML کامل وظیفه (که شامل فرمان اجرایی، تریگرها و سایر تنظیمات است) می‌باشد. Event ID 4702 نشان‌دهنده به‌روزرسانی یک وظیفه موجود است. در لاگ <code>Microsoft-Windows-TaskScheduler/Operational</code>، Event ID 106 نشان‌دهنده ثبت یک وظیفه جدید و Event ID 200 نشان‌دهنده اجرای یک وظیفه است.</p>

<p>در رجیستری سیستم مقصد، اطلاعات مربوط به وظایف زمان‌بندی شده در چندین کلید ذخیره می‌شوند. کلید <code>HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tree</code> حاوی ساختار درختی تمامی وظایف است. کلید <code>TaskCache\Tasks</code> حاوی اطلاعات دقیق هر وظیفه از جمله GUID، اقدامات (Actions) و تریگرها (Triggers) است. کلید <code>TaskCache\Boot</code> حاوی وظایفی است که در زمان بوت اجرا می‌شوند و کلید <code>TaskCache\Logon</code> حاوی وظایفی است که در زمان ورود کاربر اجرا می‌شوند.</p>

<p>در سیستم فایل سیستم مقصد، هر وظیفه زمان‌بندی شده به صورت یک فایل XML در <code>C:\Windows\System32\Tasks</code> ذخیره می‌شود. این فایل‌های XML حاوی تمامی جزئیات وظیفه از جمله فرمان اجرایی، آرگومان‌ها، تریگرها، شرایط و تنظیمات امنیتی هستند. تحلیل این فایل‌ها می‌تواند اطلاعات بسیار ارزشمندی در مورد فعالیت‌های مخرب فراهم کند.</p>

<p>یکی از نکات مهم که در پوستر اصلی به آن اشاره نشده بود، این است که وظایف زمان‌بندی شده می‌توانند تحت حساب‌های کاربری مختلفی اجرا شوند، از جمله SYSTEM، حساب‌های کاربری محلی یا حساب‌های دامنه. مهاجمان اغلب سعی می‌کنند وظایف را تحت حساب SYSTEM اجرا کنند تا به بالاترین سطح دسترسی دست یابند. همچنین، مهاجمان ممکن است وظایف را با نام‌های مشابه به وظایف مشروع سیستم ایجاد کنند تا از دید تحلیلگران پنهان بمانند. به عنوان مثال، ایجاد یک وظیفه با نام "WindowsUpdate" یا "SystemMaintenance" ممکن است در نگاه اول مشروع به نظر برسد.</p>

<p>علاوه بر این، تحلیلگران باید به وظایفی که به طور غیرمعمول اغلب اجرا می‌شوند (مثلاً هر چند دقیقه یک بار) یا وظایفی که فرمان‌های مشکوکی مانند <code>powershell.exe -enc</code> (که نشان‌دهنده اجرای یک فرمان رمزگذاری شده است) را اجرا می‌کنند، توجه ویژه‌ای داشته باشند. همچنین، وظایفی که بلافاصله پس از ایجاد اجرا می‌شوند (با استفاده از تریگر "At task creation") اغلب توسط مهاجمان برای اجرای فوری کد مخرب استفاده می‌شوند.</p>

<h3>Services</h3>

<p>سرویس‌های ویندوز برنامه‌هایی هستند که در پس‌زمینه اجرا می‌شوند و معمولاً بدون تعامل مستقیم با کاربر کار می‌کنند. مهاجمان می‌توانند با نصب یک سرویس جدید بر روی یک سیستم راه دور، کد مخرب را اجرا کنند. این تکنیک مشابه PsExec است، اما در اینجا مهاجم مستقیماً یک سرویس دائمی یا موقت ایجاد می‌کند بدون استفاده از ابزار PsExec.</p>

<p>برای ایجاد یک سرویس بر روی یک سیستم راه دور، مهاجمان معمولاً از دستور <code>sc.exe</code> با پارامتر <code>\\RemoteSystem</code> استفاده می‌کنند. همچنین، Windows Management Instrumentation (WMI) و PowerShell Remoting نیز می‌توانند برای ایجاد سرویس‌های راه دور استفاده شوند.</p>

<p>در لاگ‌های رویداد سیستم مقصد، Event ID 7045 در لاگ System نشان‌دهنده نصب یک سرویس جدید است. این رویداد شامل نام سرویس، نوع سرویس (Kernel Driver، File System Driver یا User Mode Service)، نوع شروع (Auto، Manual، Disabled)، مسیر فایل اجرایی و حساب کاربری که سرویس تحت آن اجرا می‌شود، می‌باشد. Event ID 7036 نشان‌دهنده تغییر وضعیت سرویس (شروع یا توقف) است. Event ID 4624 با Logon Type 3 در لاگ Security نشان‌دهنده یک ورود شبکه‌ای است که معمولاً قبل از ایجاد سرویس رخ می‌دهد.</p>

<p>در رجیستری سیستم مقصد، هر سرویس یک کلید در <code>HKLM\SYSTEM\CurrentControlSet\Services</code> دارد. این کلید حاوی اطلاعات مفصلی در مورد سرویس از جمله مسیر فایل اجرایی (ImagePath)، نوع شروع (Start)، نوع سرویس (Type)، حساب کاربری (ObjectName) و توضیحات (Description) است. تحلیل این کلیدها می‌تواند سرویس‌های مشکوک یا غیرمعمول را شناسایی کند.</p>

<p>در سیستم فایل سیستم مقصد، فایل اجرایی سرویس در مسیری که در هنگام ایجاد سرویس مشخص شده است، قرار دارد. این مسیر می‌تواند هر جایی باشد، اما معمولاً در <code>C:\Windows\System32</code> یا یک دایرکتوری موقت قرار دارد. همچنین، یک فایل Prefetch برای فایل اجرایی سرویس ایجاد می‌شود که اطلاعات مربوط به اجرای آن را ثبت می‌کند.</p>

<p>یکی از نکات مهم که در پوستر اصلی به آن اشاره نشده بود، این است که مهاجمان اغلب سعی می‌کنند سرویس‌هایی با نام‌های مشابه به سرویس‌های مشروع سیستم ایجاد کنند تا از دید تحلیلگران پنهان بمانند. به عنوان مثال، ایجاد یک سرویس با نام "WindowsDefender" یا "WindowsUpdate" ممکن است در نگاه اول مشروع به نظر برسد. تحلیلگران باید نه تنها به نام سرویس، بلکه به مسیر فایل اجرایی، حساب کاربری و زمان ایجاد سرویس نیز توجه کنند.</p>

<p>همچنین، برخی از سرویس‌های مخرب ممکن است به عنوان درایورهای کرنل (Kernel Drivers) نصب شوند که در سطح بسیار پایین‌تری از سیستم‌عامل اجرا می‌شوند و تشخیص آن‌ها دشوارتر است. این درایورها معمولاً با پسوند <code>.sys</code> هستند و در <code>C:\Windows\System32\drivers</code> قرار دارند. Event ID 7045 با Service Type برابر با "kernel mode driver" نشان‌دهنده نصب یک درایور کرنل است که باید با دقت بیشتری بررسی شود.</p>

<h3>Windows Management Instrumentation (WMI/WMIC)</h3>

<p>Windows Management Instrumentation (WMI) یک زیرساخت قدرتمند در ویندوز است که امکان مدیریت و نظارت بر سیستم‌ها را فراهم می‌کند. WMI به مدیران اجازه می‌دهد تا اطلاعات سیستم را جمع‌آوری کنند، تنظیمات را تغییر دهند و فرآیندها را بر روی سیستم‌های محلی و راه دور اجرا کنند. مهاجمان از WMI برای حرکت جانبی، اجرای کد از راه دور و حتی پایداری استفاده می‌کنند. WMI بر روی پروتکل RPC (پورت 135) و DCOM کار می‌کند.</p>

<p>برای اجرای یک فرآیند بر روی یک سیستم راه دور با استفاده از WMI، مهاجمان معمولاً از دستور <code>wmic.exe</code> با پارامتر <code>/node:</code> استفاده می‌کنند. همچنین، PowerShell با cmdlet های مانند <code>Invoke-WmiMethod</code> و <code>Get-WmiObject</code> نیز می‌تواند برای تعامل با WMI استفاده شود.</p>

<p>در لاگ‌های رویداد سیستم مقصد، لاگ <code>Microsoft-Windows-WMI-Activity/Operational</code> حاوی رویدادهای مربوط به فعالیت‌های WMI است. Event ID 5857 نشان‌دهنده اجرای یک Provider است، Event ID 5858 نشان‌دهنده خطا در اجرای یک Query است، Event ID 5859 نشان‌دهنده فیلتر شدن یک رویداد است، Event ID 5860 نشان‌دهنده ثبت یک Consumer موقت است و Event ID 5861 نشان‌دهنده ثبت یک Consumer دائمی است. Event ID 4688 در لاگ Security (اگر Process Creation Auditing فعال باشد) نشان‌دهنده ایجاد فرآیند <code>WmiPrvSE.exe</code> (WMI Provider Host) است که میزبان فعالیت‌های WMI است.</p>

<p>یکی از نکات مهم که در پوستر اصلی به آن اشاره نشده بود، این است که WMI می‌تواند برای ایجاد Event Subscriptions استفاده شود که یک مکانیزم قدرتمند برای پایداری است. یک Event Subscription شامل سه جزء است: یک Event Filter (که مشخص می‌کند چه رویدادی باید نظارت شود)، یک Event Consumer (که مشخص می‌کند چه اقدامی باید انجام شود) و یک Filter to Consumer Binding (که این دو را به هم متصل می‌کند). مهاجمان می‌توانند یک Event Subscription ایجاد کنند که در پاسخ به یک رویداد خاص (مانند بوت سیستم یا ورود کاربر)، کد مخرب را اجرا کند.</p>

<p>Event Subscriptions در namespace های WMI ذخیره می‌شوند و می‌توانند با استفاده از ابزارهایی مانند <code>wmic.exe</code> یا PowerShell مشاهده شوند. همچنین، فایل‌های مربوط به WMI Repository در <code>C:\Windows\System32\wbem\Repository</code> ذخیره می‌شوند و می‌توانند با ابزارهای تخصصی تجزیه و تحلیل شوند. علاوه بر این، فایل‌های لاگ WMI در <code>C:\Windows\System32\wbem\Logs</code> قرار دارند که می‌توانند اطلاعات مفیدی در مورد فعالیت‌های WMI فراهم کنند.</p>

<p>تحلیلگران همچنین باید به اتصالات شبکه‌ای به پورت 135 (RPC) و پورت‌های دینامیک بالاتر (معمولاً در محدوده 49152-65535) که توسط DCOM استفاده می‌شوند، توجه کنند. این اتصالات می‌توانند نشانه‌ای از فعالیت WMI از راه دور باشند.</p>

<h3>PowerShell Remoting</h3>

<p>PowerShell Remoting یک قابلیت قدرتمند در ویندوز است که به مدیران اجازه می‌دهد دستورات PowerShell را بر روی سیستم‌های راه دور اجرا کنند. این قابلیت بر اساس Windows Remote Management (WinRM) ساخته شده است که یک پیاده‌سازی مایکروسافت از پروتکل WS-Management است. PowerShell Remoting بر روی پورت‌های 5985 (HTTP) و 5986 (HTTPS) کار می‌کند و یک محیط تعاملی یا غیرتعاملی برای اجرای دستورات فراهم می‌کند.</p>

<p>برای استفاده از PowerShell Remoting، مهاجمان معمولاً از cmdlet های مانند <code>Enter-PSSession</code> (برای یک جلسه تعاملی)، <code>Invoke-Command</code> (برای اجرای دستورات خاص) یا <code>New-PSSession</code> (برای ایجاد یک جلسه پایدار) استفاده می‌کنند.</p>

<p>در لاگ‌های رویداد سیستم مقصد، لاگ <code>Microsoft-Windows-PowerShell/Operational</code> حاوی رویدادهای مربوط به فعالیت‌های PowerShell است. Event ID 4103 نشان‌دهنده اجرای یک Module است و Event ID 4104 نشان‌دهنده اجرای یک Script Block است که محتوای دقیق اسکریپت اجرا شده را ثبت می‌کند (اگر Script Block Logging فعال باشد). لاگ <code>Microsoft-Windows-WinRM/Operational</code> حاوی رویدادهای مربوط به فعالیت‌های WinRM است. Event ID 4624 با Logon Type 3 در لاگ Security نشان‌دهنده یک ورود شبکه‌ای است که معمولاً هنگام استفاده از PowerShell Remoting رخ می‌دهد.</p>

<p>در سیستم فایل سیستم مقصد، فرآیند <code>wsmprovhost.exe</code> (Windows Remote Management Provider Host) اجرا می‌شود که میزبان جلسات PowerShell Remoting است. وجود این فرآیند نشانه‌ای از فعالیت PowerShell Remoting است. همچنین، یک فایل Prefetch برای <code>wsmprovhost.exe</code> ایجاد می‌شود.</p>

<p>یکی از نکات مهم که در پوستر اصلی به آن اشاره نشده بود، این است که PowerShell Remoting می‌تواند در دو حالت استفاده شود: One-to-One (یک سیستم به یک سیستم) و One-to-Many (یک سیستم به چندین سیستم). در حالت One-to-Many، مهاجم می‌تواند یک دستور را به طور همزمان بر روی چندین سیستم اجرا کند که می‌تواند برای حملات گسترده استفاده شود.</p>

<p>همچنین، PowerShell دارای قابلیت‌های رمزگذاری و فشرده‌سازی است که مهاجمان اغلب از آن‌ها برای پنهان کردن کد مخرب استفاده می‌کنند. دستوراتی مانند <code>powershell.exe -enc</code> (که یک فرمان رمزگذاری شده Base64 را اجرا می‌کند) یا <code>powershell.exe -w hidden</code> (که پنجره PowerShell را پنهان می‌کند) اغلب توسط مهاجمان استفاده می‌شوند. تحلیلگران باید به دقت به آرگومان‌های خط فرمان <code>powershell.exe</code> در Event ID 4688 و Sysmon Event ID 1 توجه کنند.</p>

<p>علاوه بر این، PowerShell دارای یک قابلیت به نام Constrained Language Mode است که می‌تواند برای محدود کردن قابلیت‌های PowerShell استفاده شود. با این حال، مهاجمان پیشرفته اغلب راه‌هایی برای دور زدن این محدودیت‌ها پیدا می‌کنند. تحلیلگران باید به رویدادهایی که نشان‌دهنده تلاش برای دور زدن Constrained Language Mode هستند، مانند بارگذاری Assembly های .NET مشکوک یا استفاده از Reflection، توجه کنند.</p>

</div>
